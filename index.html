<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cloud OS ‚Äì Real-Time Translator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: linear-gradient(135deg, #111827, #020617);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
      overflow: hidden;
    }

    .desktop {
      width: 100%;
      max-width: 1100px;
      padding: 20px;
      position: relative; /* needed for absolute signature */
    }

    .taskbar {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
    }

    .taskbar-left { display:flex; align-items:center; gap:8px; font-size:14px; }
    .start-btn {
      background:#22c55e; border-radius:999px; padding:4px 10px; font-weight:600;
      border:none; cursor:default; color:#022c22; font-size:12px;
    }
    .taskbar-dot { width:6px; height:6px; border-radius:999px; background:#22c55e; }
    .taskbar-right { font-size:12px; opacity:0.8; }

    .window {
      background:rgba(15,23,42,0.95); border-radius:16px;
      border:1px solid rgba(148,163,184,0.3); box-shadow:0 18px 45px rgba(0,0,0,0.7);
      overflow:hidden; backdrop-filter:blur(16px);
    }

    .window-header {
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px; background:linear-gradient(to right,#020617,#0f172a);
      border-bottom:1px solid rgba(148,163,184,0.25);
    }

    .window-buttons { display:flex; gap:6px; }
    .window-btn { width:10px; height:10px; border-radius:999px; }
    .btn-close{background:#ef4444;} .btn-min{background:#f59e0b;} .btn-max{background:#22c55e;}

    .window-title{font-size:13px;color:#e5e7eb;display:flex;align-items:center;gap:6px;}
    .window-title span.icon{font-size:14px;}

    .badge{
      border-radius:999px;padding:2px 8px;font-size:10px;
      border:1px solid rgba(148,163,184,0.7);color:#9ca3af;
    }

    .window-body{
      padding:16px;display:grid;grid-template-columns:1.1fr 1.1fr;gap:16px;
    }

    .panel{
      background:rgba(15,23,42,0.8);border-radius:12px;
      border:1px solid rgba(75,85,99,0.6);padding:12px;display:flex;
      flex-direction:column;gap:8px;
    }

    .panel-header{
      display:flex;justify-content:space-between;align-items:center;
      font-size:13px;color:#9ca3af;
    }

    .select-wrapper{
      background:rgba(15,23,42,0.9);border:1px solid rgba(55,65,81,0.9);
      border-radius:999px;padding:4px 10px;display:inline-flex;align-items:center;
      gap:6px;font-size:12px;color:#e5e7eb;
    }

    select{
      background:transparent;border:none;outline:none;color:inherit;font-size:inherit;
      appearance:none;padding-right:14px;cursor:pointer;
    }
    .arrow-down{font-size:10px;opacity:0.7;}

    textarea{
      width:100%;height:180px;background:#020617;color:#e5e7eb;border-radius:10px;
      border:1px solid rgba(55,65,81,0.9);padding:10px;resize:vertical;font-size:14px;
      outline:none;
    }
    textarea:focus{border-color:#22c55e;box-shadow:0 0 0 1px rgba(34,197,94,0.5);}

    .status-bar{
      margin-top:6px;font-size:11px;display:flex;justify-content:space-between;
      align-items:center;color:#9ca3af;
    }
    .status-dot{width:7px;height:7px;border-radius:999px;margin-right:4px;}
    .status-ok{background:#22c55e;} .status-busy{background:#f97316;}
    .status-error{background:#ef4444;}
    .status-left{display:flex;align-items:center;gap:4px;}
    .status-right{opacity:0.9;}

    .controls-row{
      padding:0 16px 14px 16px;display:flex;justify-content:space-between;
      align-items:center;gap:10px;flex-wrap:wrap;
    }

    .pill-btn{
      border-radius:999px;border:none;padding:6px 16px;font-size:12px;font-weight:500;
      cursor:pointer;display:inline-flex;align-items:center;gap:6px;
    }
    .btn-primary{background:#22c55e;color:#052e16;}
    .btn-secondary{background:#0f172a;color:#e5e7eb;border:1px solid rgba(75,85,99,0.8);}

    @media (max-width:800px){.window-body{grid-template-columns:1fr;}textarea{height:140px;}}

    /* Minimal signature: absolute, centered, does not affect layout */
    .signature {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 8px;
      font-size: 12px;
      color: #94a3b8;
      opacity: 0.6;
      pointer-events: none; /* don't interfere with clicks */
      user-select: none;
      white-space: nowrap;
    }

  </style>
</head>
<body>
  <div class="desktop">
    <div class="taskbar">
      <div class="taskbar-left">
        <button class="start-btn">Cloud OS</button>
        <div class="taskbar-dot"></div>
        <span>Real-Time Translator</span>
      </div>
      <div class="taskbar-right" id="clock"></div>
    </div>

    <div class="window">
      <div class="window-header">
        <div class="window-buttons">
          <div class="window-btn btn-close"></div>
          <div class="window-btn btn-min"></div>
          <div class="window-btn btn-max"></div>
        </div>
        <div class="window-title">
          <span class="icon">üåê</span>
          <span>Language Translator ‚Äì Live</span>
        </div>
        <div class="badge">Real-time</div>
      </div>

      <div class="window-body">
        <!-- Input -->
        <div class="panel">
          <div class="panel-header">
            <span>Input</span>
            <div class="select-wrapper">
              <span>From</span>
              <select id="sourceLang">
                <option value="en">English</option>
                <option value="hi">Hindi</option>
                <option value="fr">French</option>
                <option value="es">Spanish</option>
                <option value="de">German</option>
                <option value="bn">Bengali</option>
              </select>
              <span class="arrow-down">‚ñº</span>
            </div>
          </div>
          <textarea id="sourceText" placeholder="Type text here..."></textarea>
          <div class="status-bar">
            <div class="status-left">
              <div class="status-dot status-ok" id="statusDot"></div>
              <span id="statusText">Idle ‚Äì waiting for input</span>
            </div>
            <div class="status-right" id="charCount">0 chars</div>
          </div>
        </div>

        <!-- Output -->
        <div class="panel">
          <div class="panel-header">
            <span>Output</span>
            <div class="select-wrapper">
              <span>To</span>
              <select id="targetLang">
                <option value="hi">Hindi</option>
                <option value="en">English</option>
                <option value="fr">French</option>
                <option value="es">Spanish</option>
                <option value="de">German</option>
                <option value="bn">Bengali</option>
              </select>
              <span class="arrow-down">‚ñº</span>
            </div>
          </div>
          <textarea id="targetText" placeholder="Translation will appear here..." readonly></textarea>
          <div class="status-bar">
            <div class="status-left">
              <span style="font-size:11px;">üîÅ Real-time translation enabled</span>
            </div>
            <div class="status-right" id="lastUpdated">Last updated: ‚Äî</div>
          </div>
        </div>
      </div>

      <div class="controls-row">
        <button class="pill-btn btn-secondary" id="swapBtn">‚áÑ Swap</button>
        <button class="pill-btn btn-primary" id="translateNowBtn">‚ö° Translate Now</button>
      </div>
    </div>

    <!-- Minimal signature (does not change page width/layout) -->
    <div class="signature">SmactorOrWot</div>
  </div>

  <script>
    // ===== CLOCK =====
    function updateClock() {
      const clock = document.getElementById("clock");
      const now = new Date();
      clock.textContent =
        now.toLocaleDateString() +
        "  |  " +
        now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
    }
    setInterval(updateClock, 1000);
    updateClock();

    // ===== ELEMENTS =====
    const sourceText   = document.getElementById("sourceText");
    const targetText   = document.getElementById("targetText");
    const sourceLang   = document.getElementById("sourceLang");
    const targetLang   = document.getElementById("targetLang");
    const charCount    = document.getElementById("charCount");
    const statusDot    = document.getElementById("statusDot");
    const statusText   = document.getElementById("statusText");
    const lastUpdated  = document.getElementById("lastUpdated");
    const translateNowBtn = document.getElementById("translateNowBtn");
    const swapBtn      = document.getElementById("swapBtn");

    let typingTimer;
    const TYPING_DELAY = 600;

    function setIdle() {
      statusDot.className = "status-dot status-ok";
      statusText.textContent = "Idle ‚Äì waiting for input";
    }
    function setBusy(msg) {
      statusDot.className = "status-dot status-busy";
      statusText.textContent = msg || "Translating‚Ä¶";
    }
    function setError(msg) {
      statusDot.className = "status-dot status-error";
      statusText.textContent = msg || "Error during translation";
    }
    function setUpdated() {
      const now = new Date();
      lastUpdated.textContent =
        "Last updated: " +
        now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit"
        });
    }

    // ===== SANITIZE HINDI TRANSLATION (removes '‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ö‡§∞‡•ç‡§•', etc.) =====
    function sanitizeTranslation(src, translation, from, to) {
      let t = (translation || "").trim();

      if (to === "hi") {
        // remove common garbage suffixes from TM (case-insensitive)
        t = t.replace(/‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ö‡§∞‡•ç‡§•.*$/i, "").trim();
        t = t.replace(/‡§ï‡§æ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ö‡§∞‡•ç‡§•.*$/i, "").trim();
        t = t.replace(/‡§ï‡§æ ‡§Ö‡§∞‡•ç‡§•.*$/i, "").trim();
      }

      return t;
    }

    // ===== REAL-TIME INPUT LISTENER =====
    sourceText.addEventListener("input", () => {
      const len = sourceText.value.length;
      charCount.textContent = len + " chars";

      if (!sourceText.value.trim()) {
        targetText.value = "";
        setIdle();
        return;
      }

      setBusy("Listening‚Ä¶ translating in real time");
      clearTimeout(typingTimer);
      typingTimer = setTimeout(() => translate(false), TYPING_DELAY);
    });

    translateNowBtn.addEventListener("click", () => translate(true));

    swapBtn.addEventListener("click", () => {
      const tmpLang = sourceLang.value;
      sourceLang.value = targetLang.value;
      targetLang.value = tmpLang;

      const tmpText = sourceText.value;
      sourceText.value = targetText.value;
      targetText.value = tmpText;

      charCount.textContent = sourceText.value.length + " chars";
      if (sourceText.value.trim()) translate(true);
      else setIdle();
    });

    // ===== MAIN TRANSLATE FUNCTION (MyMemory + cleanup) =====
    async function translate(force = false) {
      const text = sourceText.value.trim();
      const from = sourceLang.value;
      const to   = targetLang.value;

      if (!text) {
        setIdle();
        targetText.value = "";
        return;
      }

      if (!force && text.length < 2) {
        setIdle();
        return;
      }

      setBusy("Translating‚Ä¶");

      try {
        const url =
          "https://api.mymemory.translated.net/get?" +
          "q=" + encodeURIComponent(text) +
          "&langpair=" + encodeURIComponent(from + "|" + to);

        const res = await fetch(url);
        const data = await res.json();

        console.log("RAW MyMemory response:", data);

        let translated = "";

        // main translatedText
        if (data &&
            data.responseData &&
            typeof data.responseData.translatedText === "string") {
          translated = data.responseData.translatedText;
        }

        // sanitize weird suffixes like "‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ö‡§∞‡•ç‡§•"
        translated = sanitizeTranslation(text, translated, from, to);

        if (translated && translated.trim().length > 0) {
          targetText.value = translated;
          setIdle();
          setUpdated();
        } else {
          // if still nothing reasonable
          targetText.value = "";
          setError("No reliable translation (see console).");
        }
      } catch (err) {
        console.error("Translation error:", err);
        setError("Network error ‚Äì check internet");
      }
    }

    // start in idle state
    setIdle();
  </script>
</body>
</html>
